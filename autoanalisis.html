<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompuZetta Enhanced Top-Down EUR/USD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 3rem;
            background: linear-gradient(45deg, #00d4ff, #00ff88, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 300% 100%;
            animation: gradientShift 8s ease infinite;
            text-shadow: 0 0 40px rgba(0, 212, 255, 0.4);
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .strategy-header {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), rgba(0, 255, 136, 0.15));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 8px solid #00d4ff;
            position: relative;
            overflow: hidden;
        }

        .strategy-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
            transform: translateX(-100%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            100% { transform: translateX(100%); }
        }

        .enhanced-timeframe-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeframe-btn {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 20px;
            border-radius: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.4s ease;
            font-weight: bold;
            font-size: 0.9rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .timeframe-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .timeframe-btn:hover::before {
            left: 100%;
        }

        .timeframe-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.2), rgba(0, 255, 136, 0.2));
        }

        .timeframe-btn.active {
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            color: #000;
            border-color: #00d4ff;
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
        }

        .timeframe-btn.completed {
            background: linear-gradient(45deg, #00ff88, #32ff7e);
            border-color: #00ff88;
        }

        .multiple-setups-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .setup-detector {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1));
            border-radius: 20px;
            padding: 25px;
            border-left: 6px solid #ffd700;
            position: relative;
        }

        .setup-zone {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 255, 136, 0.1));
            border-radius: 20px;
            padding: 25px;
            border-left: 6px solid #00d4ff;
        }

        .setup-primary {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), rgba(238, 90, 36, 0.15));
            border: 2px solid rgba(255, 107, 107, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .setup-secondary {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 212, 255, 0.1));
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .setup-scalp {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .confluence-panel {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .confluence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .confluence-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
            border-radius: 12px;
            padding: 15px;
            border-left: 4px solid #00d4ff;
            position: relative;
        }

        .confluence-weight {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .confidence-meter {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .confidence-bar {
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(90deg, #ff6b6b 0%, #feca57 50%, #00ff88 100%);
            position: relative;
            overflow: hidden;
        }

        .confidence-indicator {
            position: absolute;
            top: -5px;
            height: 30px;
            width: 4px;
            background: #fff;
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transition: left 0.5s ease;
        }

        .timeline-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeline-section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid;
        }

        .timeline-immediate {
            background: rgba(255, 193, 7, 0.1);
            border-left-color: #ffc107;
        }

        .timeline-short {
            background: rgba(0, 212, 255, 0.1);
            border-left-color: #00d4ff;
        }

        .timeline-macro {
            background: rgba(255, 107, 107, 0.1);
            border-left-color: #ff6b6b;
        }

        .smart-context {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 6px solid #8a2be2;
            position: relative;
        }

        .alert-system {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .alert-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border-top: 4px solid;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .alert-yellow { border-top-color: #ffc107; }
        .alert-orange { border-top-color: #ff9500; }
        .alert-red { border-top-color: #ff6b6b; }

        .enhanced-export {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 212, 255, 0.15));
            border-radius: 25px;
            padding: 30px;
            margin-top: 30px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            position: relative;
            overflow: hidden;
        }

        .enhanced-export::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            animation: exportShimmer 4s infinite;
        }

        @keyframes exportShimmer {
            100% { transform: translateX(100%); }
        }

        .export-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .setup-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid;
            position: relative;
            transition: all 0.3s ease;
        }

        .setup-card:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .setup-macro { border-left-color: #ff6b6b; }
        .setup-immediate { border-left-color: #00d4ff; }
        .setup-alternative { border-left-color: #ffd700; }

        .export-button {
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            border: none;
            padding: 20px 40px;
            border-radius: 30px;
            color: #000;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
            position: relative;
            overflow: hidden;
        }

        .export-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .export-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .export-button:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 50px rgba(0, 255, 136, 0.5);
        }

        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 3px dashed rgba(255, 255, 255, 0.3);
            text-align: center;
            transition: all 0.4s ease;
            position: relative;
        }

        .upload-section:hover {
            border-color: #00d4ff;
            box-shadow: 0 0 40px rgba(0, 212, 255, 0.2);
            transform: scale(1.02);
        }

        .upload-btn {
            background: linear-gradient(45deg, #00d4ff, #00ff88);
            border: none;
            padding: 18px 35px;
            border-radius: 25px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 212, 255, 0.4);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-analysis {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: #00d4ff;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 4px solid #00d4ff;
            width: 50px;
            height: 50px;
            animation: spin 1.2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .price-tag {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .time-tag {
            background: linear-gradient(45deg, #00d4ff, #0fbcf9);
            color: #000;
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .risk-tag {
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .risk-low { background: #00ff88; color: #000; }
        .risk-medium { background: #ffc107; color: #000; }
        .risk-high { background: #ff6b6b; color: #fff; }

        .hidden { display: none; }

        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, .2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, .2) 50%,
                rgba(255, 255, 255, .2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }

        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .multiple-setups-panel {
                grid-template-columns: 1fr;
            }
            
            .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .confluence-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ CompuZetta Enhanced Top-Down EUR/USD</h1>
        
        <div class="strategy-header">
            <h2 style="color: #00d4ff; margin-bottom: 15px;">üéØ Estrategia Multi-Setup Avanzada</h2>
            <p><strong>12M ‚Üí 6M ‚Üí 3M ‚Üí MN ‚Üí W1 ‚Üí D1 ‚Üí H4</strong> | Detecta m√∫ltiples oportunidades en cada recorrido</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">
                Sistema inteligente que encuentra TODOS los setups disponibles: desde scalps inmediatos hasta objetivos macro
            </p>
        </div>

        <!-- Progress Section -->
        <div class="progress-section">
            <h3 style="color: #ffd700; margin-bottom: 15px;">üìä Progreso del An√°lisis</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="overallProgress" style="width: 0%"></div>
            </div>
            <div style="text-align: center; color: #00d4ff;">
                <span id="progressText">0/7 Temporalidades Completadas</span>
            </div>
        </div>

        <!-- Enhanced Timeframe Selector -->
        <div class="enhanced-timeframe-selector">
            <button class="timeframe-btn active" onclick="selectTimeframe('12M')" id="btn-12M">
                üìà 12M<br><small>Macro S√∫per</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('6M')" id="btn-6M">
                üìä 6M<br><small>Macro Extendida</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('3M')" id="btn-3M">
                üìã 3M<br><small>Macro Intermedia</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('MN')" id="btn-MN">
                üóìÔ∏è MN<br><small>Mensual</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('W1')" id="btn-W1">
                üìÖ W1<br><small>Semanal</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('D1')" id="btn-D1">
                üìÜ D1<br><small>Diario</small>
            </button>
            <button class="timeframe-btn" onclick="selectTimeframe('H4')" id="btn-H4">
                ‚ö° H4<br><small>Ejecuci√≥n</small>
            </button>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h3 id="upload-title">üìä Sube tu gr√°fico de 12M - Macro S√∫per Estructura</h3>
            <p style="margin: 15px 0; opacity: 0.8;" id="upload-desc">
                Comenzamos con el an√°lisis de s√∫per macro para detectar ciclos de a√±os
            </p>
            <input type="file" class="file-input" id="fileInput" accept="image/*" style="display: none;">
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                üìÅ <span id="upload-btn-text">Subir Gr√°fico 12M</span>
            </button>
        </div>

        <!-- Multiple Setups Panel -->
        <div class="multiple-setups-panel hidden" id="setupsPanel">
            <div class="setup-detector">
                <h3 style="color: #ffd700; margin-bottom: 20px;">üéØ DETECTOR DE OPORTUNIDADES</h3>
                <div id="setupsPrimary"></div>
                <div id="setupsSecondary"></div>
            </div>
            
            <div class="setup-zone">
                <h3 style="color: #00d4ff; margin-bottom: 20px;">üìç AN√ÅLISIS DE ZONAS</h3>
                <div id="reactionZones"></div>
                <div id="arrivalTimes"></div>
            </div>
        </div>

        <!-- Confluence Panel -->
        <div class="confluence-panel hidden" id="confluencePanel">
            <h3 style="color: #00ff88; margin-bottom: 20px;">üìä MAPA DE CONFLUENCIAS PROGRESIVAS</h3>
            <div class="confluence-grid" id="confluenceGrid"></div>
            
            <div class="confidence-meter">
                <h4 style="color: #ffd700; margin-bottom: 15px;">üí™ CONFIANZA TOTAL DEL SETUP</h4>
                <div class="confidence-bar" id="confidenceBar">
                    <div class="confidence-indicator" id="confidenceIndicator"></div>
                </div>
                <p style="margin-top: 10px; font-size: 1.2rem; font-weight: bold;" id="confidenceText">0%</p>
            </div>
        </div>

        <!-- Timeline Panel -->
        <div class="timeline-panel hidden" id="timelinePanel">
            <h3 style="color: #ff6b6b; margin-bottom: 25px;">üìÖ CRONOGRAMA DE SETUPS</h3>
            
            <div class="timeline-section timeline-immediate">
                <h4 style="color: #ffc107; margin-bottom: 15px;">üîú PR√ìXIMAS 24H</h4>
                <div id="immediate-setups"></div>
            </div>
            
            <div class="timeline-section timeline-short">
                <h4 style="color: #00d4ff; margin-bottom: 15px;">üìä PR√ìXIMOS 3-7 D√çAS</h4>
                <div id="short-term-setups"></div>
            </div>
            
            <div class="timeline-section timeline-macro">
                <h4 style="color: #ff6b6b; margin-bottom: 15px;">üéØ OBJETIVO MACRO (2-4 SEMANAS)</h4>
                <div id="macro-setups"></div>
            </div>
        </div>

        <!-- Smart Context -->
        <div class="smart-context hidden" id="smartContext">
            <h3 style="color: #8a2be2; margin-bottom: 20px;">ü§ñ AN√ÅLISIS INTELIGENTE</h3>
            <div id="contextAnalysis"></div>
        </div>

        <!-- Alert System -->
        <div class="alert-system hidden" id="alertSystem">
            <h3 style="color: #ffd700; margin-bottom: 20px; grid-column: 1/-1;">üîî SISTEMA DE ALERTAS GRADUALES</h3>
            <div id="alertItems"></div>
        </div>

        <!-- Analysis Grid -->
        <div class="analysis-grid hidden" id="analysisGrid">
            <div class="chart-analysis">
                <h4 style="color: #00d4ff; margin-bottom: 15px;" id="currentAnalysisTitle">An√°lisis Actual</h4>
                <div id="chartContainer"></div>
            </div>
            <div class="chart-analysis">
                <h4 style="color: #00ff88; margin-bottom: 15px;">üìä Resultados del An√°lisis</h4>
                <div id="analysisResults">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Esperando gr√°fico...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Export Panel -->
        <div class="enhanced-export hidden" id="exportPanel">
            <h2 style="color: #00ff88; margin-bottom: 25px; text-align: center;">
                üì§ EXPORT PARA EJECUCI√ìN PRECISA
            </h2>
            
            <div class="export-section">
                <h4 style="color: #ffd700; margin-bottom: 15px;">üìä CONTEXTO MACRO COMPLETO</h4>
                <div id="macroContext"></div>
            </div>
            
            <div class="export-section">
                <h4 style="color: #00d4ff; margin-bottom: 15px;">‚ö° SETUPS DETECTADOS</h4>
                <div id="exportSetups"></div>
            </div>
            
            <div class="export-section">
                <h4 style="color: #ff6b6b; margin-bottom: 15px;">‚ùå INVALIDACIONES CR√çTICAS</h4>
                <div id="invalidations"></div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="export-button" onclick="exportToPreciseExecution()">

üöÄ EXPORTAR A EJECUCI√ìN PRECISA
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTimeframe = '12M';
        let analysisData = {
            '12M': null,
            '6M': null,
            '3M': null,
            'MN': null,
            'W1': null,
            'D1': null,
            'H4': null
        };
        let completedTimeframes = [];
        let totalConfluenceScore = 0;
        let detectedSetups = [];
        let currentStep = 0;
        let overallProgress = 0;

        const timeframeConfig = {
            '12M': {
                title: 'üìà 12M - Macro S√∫per Estructura',
                description: 'Ciclos de a√±os - Detectar macro tendencias de largo plazo',
                uploadText: 'Subir Gr√°fico 12M',
                weight: 40,
                timeEstimate: '6-18 meses',
                icon: 'üìà'
            },
            '6M': {
                title: 'üìä 6M - Macro Extendida', 
                description: 'Estructura macro intermedia - Confirmar ciclos mayores',
                uploadText: 'Subir Gr√°fico 6M',
                weight: 35,
                timeEstimate: '3-12 meses',
                icon: 'üìä'
            },
            '3M': {
                title: 'üìã 3M - Macro Intermedia',
                description: 'Transici√≥n macro-micro - Identificar impulsos principales',
                uploadText: 'Subir Gr√°fico 3M',
                weight: 25,
                timeEstimate: '6-12 semanas',
                icon: 'üìã'
            },
            'MN': {
                title: 'üóìÔ∏è MN - Mensual',
                description: 'Direcci√≥n macro definida - Zonas de reacci√≥n mensual',
                uploadText: 'Subir Gr√°fico MN',
                weight: 20,
                timeEstimate: '4-8 semanas',
                icon: 'üóìÔ∏è'
            },
            'W1': {
                title: 'üìÖ W1 - Semanal',
                description: 'Impulso vs retroceso - Timing de entrada macro',
                uploadText: 'Subir Gr√°fico W1',
                weight: 15,
                timeEstimate: '1-4 semanas',
                icon: 'üìÖ'
            },
            'D1': {
                title: 'üìÜ D1 - Diario',
                description: 'Confirmaci√≥n direccional - Zonas de demanda/supply',
                uploadText: 'Subir Gr√°fico D1',
                weight: 10,
                timeEstimate: '3-10 d√≠as',
                icon: 'üìÜ'
            },
            'H4': {
                title: '‚ö° H4 - Ejecuci√≥n',
                description: 'Timing preciso - CHoCH y zonas de entrada inmediata',
                uploadText: 'Subir Gr√°fico H4',
                weight: 5,
                timeEstimate: '4-24 horas',
                icon: '‚ö°'
            }
        };

        const multiSetupTemplates = {
            primary: {
                type: 'MACRO PRINCIPAL',
                class: 'setup-primary',
                icon: 'üéØ'
            },
            secondary: {
                type: 'SWING INTERMEDIO',
                class: 'setup-secondary', 
                icon: 'üìà'
            },
            scalp: {
                type: 'SCALP/INTRADAY',
                class: 'setup-scalp',
                icon: '‚ö°'
            }
        };

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                processTimeframeChart(file, currentTimeframe);
            }
        });

        function selectTimeframe(timeframe) {
            currentTimeframe = timeframe;
            updateTimeframeUI();
        }

        function updateTimeframeUI() {
            // Update buttons
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.classList.remove('active');
                if (completedTimeframes.includes(btn.id.replace('btn-', ''))) {
                    btn.classList.add('completed');
                }
            });
            document.getElementById(`btn-${currentTimeframe}`).classList.add('active');

            // Update upload section
            const config = timeframeConfig[currentTimeframe];
            document.getElementById('upload-title').textContent = `${config.icon} Sube tu gr√°fico de ${currentTimeframe} - ${config.title.split(' - ')[1]}`;
            document.getElementById('upload-desc').textContent = config.description;
            document.getElementById('upload-btn-text').textContent = config.uploadText;

            // Clear file input
            document.getElementById('fileInput').value = '';
        }

        function updateOverallProgress() {
            const totalTimeframes = 7;
            const completed = completedTimeframes.length;
            const progressPercent = (completed / totalTimeframes) * 100;
            
            document.getElementById('overallProgress').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = `${completed}/${totalTimeframes} Temporalidades Completadas`;

            overallProgress = progressPercent;
        }

        function processTimeframeChart(file, timeframe) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const analysisResults = analyzeTimeframeStructure(timeframe, e.target.result);
                analysisData[timeframe] = analysisResults;
                
                // Mark as completed
                if (!completedTimeframes.includes(timeframe)) {
                    completedTimeframes.push(timeframe);
                }
                
                // Show analysis panels
                displayTimeframeAnalysis(timeframe, analysisResults);
                updateOverallProgress();
                updateConfluenceAnalysis();
                
                // Auto-advance to next timeframe
                setTimeout(() => {
                    advanceToNextTimeframe();
                }, 2000);
            };
            reader.readAsDataURL(file);
        }

        function analyzeTimeframeStructure(timeframe, imageData) {
            // Simulate sophisticated multi-setup analysis
            const structures = ['Alcista', 'Bajista', 'Consolidaci√≥n'];
            const structure = structures[Math.floor(Math.random() * structures.length)];
            
            const basePrice = 1.1800;
            const variation = (Math.random() - 0.5) * 0.0300;
            const currentPrice = basePrice + variation;
            
            // Generate multiple setups for this timeframe
            const setups = generateMultipleSetups(timeframe, structure, currentPrice);
            
            return {
                timeframe,
                structure,
                currentPrice: currentPrice.toFixed(4),
                setups,
                confluences: generateConfluences(timeframe),
                reactionZones: generateReactionZones(timeframe, currentPrice),
                timeEstimates: generateTimeEstimates(timeframe),
                imageData
            };
        }

        function generateMultipleSetups(timeframe, structure, price) {
            const setups = [];
            const config = timeframeConfig[timeframe];
            
            // Primary setup (main direction)
            setups.push({
                type: 'primary',
                name: `Setup Macro ${timeframe}`,
                direction: structure,
                entry: (price + (Math.random() - 0.5) * 0.0050).toFixed(4),
                sl: (price + (Math.random() - 0.5) * 0.0100).toFixed(4),
                tp: (price + (Math.random() - 0.5) * 0.0200).toFixed(4),
                timeframe: config.timeEstimate,
                confidence: 75 + Math.floor(Math.random() * 20),
                description: `Setup principal siguiendo estructura ${structure.toLowerCase()} de ${timeframe}`
            });

            // Secondary setups (during the journey)
            if (['12M', '6M', '3M', 'MN', 'W1'].includes(timeframe)) {
                setups.push({
                    type: 'secondary',
                    name: `Swing Intermedio`,
                    direction: structure === 'Bajista' ? 'Alcista' : 'Bajista',
                    entry: (price + (Math.random() - 0.5) * 0.0030).toFixed(4),
                    sl: (price + (Math.random() - 0.5) * 0.0060).toFixed(4),
                    tp: (price + (Math.random() - 0.5) * 0.0120).toFixed(4),
                    timeframe: '3-7 d√≠as',
                    confidence: 60 + Math.floor(Math.random() * 25),
                    description: `Retroceso t√©cnico dentro de ${structure.toLowerCase()} mayor`
                });
            }

            // Scalp setups (immediate opportunities)
            if (['D1', 'H4'].includes(timeframe)) {
                setups.push({
                    type: 'scalp',
                    name: `Scalp Inmediato`,
                    direction: Math.random() > 0.5 ? 'Alcista' : 'Bajista',
                    entry: (price + (Math.random() - 0.5) * 0.0020).toFixed(4),
                    sl: (price + (Math.random() - 0.5) * 0.0040).toFixed(4),
                    tp: (price + (Math.random() - 0.5) * 0.0080).toFixed(4),
                    timeframe: '2-8 horas',
                    confidence: 50 + Math.floor(Math.random() * 30),
                    description: `Oportunidad intraday en zona de reacci√≥n`
                });
            }

            return setups;
        }

        function generateConfluences(timeframe) {
            const confluenceTypes = [
                'Estructura clara',
                'FVG identificado', 
                'Nivel de reacci√≥n',
                'Volumen confirmado',
                'Divergencia RSI',
                'Zona de supply/demand',
                'Retroceso Fibonacci',
                'Patr√≥n arm√≥nico'
            ];
            
            const count = 2 + Math.floor(Math.random() * 4);
            const selected = [];
            
            for (let i = 0; i < count; i++) {
                const confluence = confluenceTypes[Math.floor(Math.random() * confluenceTypes.length)];
                if (!selected.includes(confluence)) {
                    selected.push(confluence);
                }
            }
            
            return selected;
        }

        function generateReactionZones(timeframe, currentPrice) {
            const zones = [];
            const config = timeframeConfig[timeframe];
            
            // Generate 2-4 reaction zones
            for (let i = 0; i < 2 + Math.floor(Math.random() * 3); i++) {
                const distance = (Math.random() - 0.5) * 0.0200;
                const zonePrice = currentPrice + distance;
                
                zones.push({
                    price: zonePrice.toFixed(4),
                    type: distance > 0 ? 'Resistencia' : 'Soporte',
                    strength: ['D√©bil', 'Moderada', 'Fuerte'][Math.floor(Math.random() * 3)],
                    arrivalTime: generateArrivalTime(timeframe)
                });
            }
            
            return zones;
        }

        function generateTimeEstimates(timeframe) {
            const estimates = {
                immediate: `Pr√≥ximas ${Math.floor(Math.random() * 12) + 4} horas`,
                shortTerm: `${Math.floor(Math.random() * 5) + 2}-${Math.floor(Math.random() * 8) + 5} d√≠as`,
                macro: timeframeConfig[timeframe].timeEstimate
            };
            
            return estimates;
        }

        function generateArrivalTime(timeframe) {
            const timeframes = {
                '12M': ['6-18 meses', '12-24 meses'],
                '6M': ['3-9 meses', '6-15 meses'],
                '3M': ['6-12 semanas', '8-20 semanas'],
                'MN': ['2-6 semanas', '4-10 semanas'],
                'W1': ['1-3 semanas', '2-5 semanas'],
                'D1': ['3-7 d√≠as', '5-12 d√≠as'],
                'H4': ['4-12 horas', '8-24 horas']
            };
            
            const options = timeframes[timeframe] || ['Indefinido'];
            return options[Math.floor(Math.random() * options.length)];
        }

        function displayTimeframeAnalysis(timeframe, analysis) {
            // Show panels
            document.getElementById('setupsPanel').classList.remove('hidden');
            document.getElementById('confluencePanel').classList.remove('hidden');
            document.getElementById('timelinePanel').classList.remove('hidden');
            document.getElementById('smartContext').classList.remove('hidden');
            document.getElementById('alertSystem').classList.remove('hidden');
            document.getElementById('analysisGrid').classList.remove('hidden');
            document.getElementById('exportPanel').classList.remove('hidden');

            // Display setups
            displaySetups(analysis.setups);
            
            // Display reaction zones
            displayReactionZones(analysis.reactionZones);
            
            // Update timeline
            updateTimeline(analysis);
            
            // Show chart
            displayChart(timeframe, analysis.imageData);
            
            // Update smart context
            updateSmartContext(timeframe, analysis);
            
            // Update alerts
            updateAlertSystem(analysis);
        }

        function displaySetups(setups) {
            const primaryContainer = document.getElementById('setupsPrimary');
            const secondaryContainer = document.getElementById('setupsSecondary');
            
            primaryContainer.innerHTML = '';
            secondaryContainer.innerHTML = '';
            
            setups.forEach(setup => {
                const setupHtml = createSetupCard(setup);
                
                if (setup.type === 'primary') {
                    primaryContainer.innerHTML += setupHtml;
                } else {
                    secondaryContainer.innerHTML += setupHtml;
                }
            });
        }

        function createSetupCard(setup) {
            const template = multiSetupTemplates[setup.type];
            const directionClass = setup.direction === 'Alcista' ? 'bullish' : 'bearish';
            
            return `
                <div class="${template.class}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #ffd700;">${template.icon} ${setup.name}</h4>
                        <span class="confidence-tag" style="background: rgba(0,212,255,0.2); padding: 4px 8px; border-radius: 10px; font-size: 0.8rem;">
                            ${setup.confidence}%
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <span class="setup-badge ${directionClass}">${setup.direction}</span>
                        </div>
                        <div>
                            <span class="time-tag">${setup.timeframe}</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                        <div>
                            <small style="opacity: 0.7;">Entrada:</small><br>
                            <span class="price-tag">${setup.entry}</span>
                        </div>
                        <div>
                            <small style="opacity: 0.7;">Stop:</small><br>
                            <span style="color: #ff6b6b;">${setup.sl}</span>
                        </div>
                        <div>
                            <small style="opacity: 0.7;">Target:</small><br>
                            <span style="color: #00ff88;">${setup.tp}</span>
                        </div>
                    </div>
                    
                    <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px;">${setup.description}</p>
                </div>
            `;
        }

        function displayReactionZones(zones) {
            const container = document.getElementById('reactionZones');
            let html = '<h4 style="color: #00d4ff; margin-bottom: 15px;">üìç Zonas de Reacci√≥n Detectadas</h4>';
            
            zones.forEach(zone => {
                const typeClass = zone.type === 'Resistencia' ? 'bearish' : 'bullish';
                html += `
                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${zone.type === 'Resistencia' ? '#ff6b6b' : '#00ff88'};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>${zone.price}</strong> - ${zone.type}</span>
                            <span class="setup-badge ${typeClass}">${zone.strength}</span>
                        </div>
                        <small style="opacity: 0.7;">Llegada estimada: ${zone.arrivalTime}</small>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateTimeline(analysis) {
            // Immediate setups
            const immediateContainer = document.getElementById('immediate-setups');
            const immediateSetups = analysis.setups.filter(s => s.type === 'scalp');
            
            immediateContainer.innerHTML = immediateSetups.map(setup => `
                <div style="background: rgba(255,193,7,0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${setup.name}</strong>
                        <span class="time-tag">${setup.timeframe}</span>
                    </div>
                    <p style="margin-top: 8px; font-size: 0.9rem;">${setup.description}</p>
                    <div style="margin-top: 10px;">
                        <span class="price-tag">${setup.entry}</span>
                        <span style="margin: 0 10px;">‚Üí</span>
                        <span style="color: #00ff88;">${setup.tp}</span>
                    </div>
                </div>
            `).join('');

            // Short term setups
            const shortContainer = document.getElementById('short-term-setups');
            const shortSetups = analysis.setups.filter(s => s.type === 'secondary');
            
            shortContainer.innerHTML = shortSetups.map(setup => `
                <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${setup.name}</strong>
                        <span class="time-tag">${setup.timeframe}</span>
                    </div>
                    <p style="margin-top: 8px; font-size: 0.9rem;">${setup.description}</p>
                    <div style="margin-top: 10px;">
                        <span class="price-tag">${setup.entry}</span>
                        <span style="margin: 0 10px;">‚Üí</span>
                        <span style="color: #00ff88;">${setup.tp}</span>
                    </div>
                </div>
            `).join('');

            // Macro setups
            const macroContainer = document.getElementById('macro-setups');
            const macroSetups = analysis.setups.filter(s => s.type === 'primary');
            
            macroContainer.innerHTML = macroSetups.map(setup => `
                <div style="background: rgba(255,107,107,0.1); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong>${setup.name}</strong>
                        <span class="time-tag">${setup.timeframe}</span>
                    </div>
                    <p style="margin-top: 8px; font-size: 0.9rem;">${setup.description}</p>
                    <div style="margin-top: 10px;">
                        <span class="price-tag">${setup.entry}</span>
                        <span style="margin: 0 10px;">‚Üí</span>
                        <span style="color: #00ff88;">${setup.tp}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateConfluenceAnalysis() {
            const confluenceContainer = document.getElementById('confluenceGrid');
            const allConfluences = [];
            let totalWeight = 0;
            let weightedScore = 0;

            // Collect all confluences
            Object.keys(analysisData).forEach(tf => {
                if (analysisData[tf]) {
                    const tfConfig = timeframeConfig[tf];
                    const confluences = analysisData[tf].confluences;
                    
                    confluences.forEach(confluence => {
                        allConfluences.push({
                            timeframe: tf,
                            confluence,
                            weight: tfConfig.weight
                        });
                    });

                    totalWeight += tfConfig.weight * confluences.length;
                    weightedScore += tfConfig.weight * confluences.length;
                }
            });

            // Display confluences
            confluenceContainer.innerHTML = allConfluences.map(item => `
                <div class="confluence-item">
                    <div class="confluence-weight">${item.weight}%</div>
                    <h5 style="color: #00d4ff; margin-bottom: 8px;">${item.timeframe}</h5>
                    <p style="font-size: 0.9rem;">${item.confluence}</p>
                </div>
            `).join('');

            // Update confidence meter
            const confidencePercent = Math.min((weightedScore / 100) * 100, 100);
            updateConfidenceMeter(confidencePercent);
        }

        function updateConfidenceMeter(confidence) {
            const indicator = document.getElementById('confidenceIndicator');
            const text = document.getElementById('confidenceText');
            
            indicator.style.left = confidence + '%';
            text.textContent = Math.round(confidence) + '%';
        }

        function displayChart(timeframe, imageData) {
            const container = document.getElementById('chartContainer');
            const title = document.getElementById('currentAnalysisTitle');
            
            title.textContent = `An√°lisis ${timeframe} - ${timeframeConfig[timeframe].title}`;
            
            container.innerHTML = `
                <img src="${imageData}" alt="${timeframe} Chart" class="chart-image">
            `;

            // Update analysis results
            const resultsContainer = document.getElementById('analysisResults');
            const analysis = analysisData[timeframe];
            
            resultsContainer.innerHTML = `
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
                    <h5 style="color: #ffd700; margin-bottom: 15px;">üìä An√°lisis Completado</h5>
                    <p><strong>Estructura:</strong> ${analysis.structure}</p>
                    <p><strong>Precio Actual:</strong> ${analysis.currentPrice}</p>
                    <p><strong>Setups Detectados:</strong> ${analysis.setups.length}</p>
                    <p><strong>Zonas de Reacci√≥n:</strong> ${analysis.reactionZones.length}</p>
                    <div style="margin-top: 15px;">
                        <h6 style="color: #00ff88; margin-bottom: 10px;">Confluencias:</h6>
                        ${analysis.confluences.map(c => `<span class="setup-badge neutral" style="margin: 2px; font-size: 0.8rem;">${c}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        function updateSmartContext(timeframe, analysis) {
            const container = document.getElementById('contextAnalysis');
            
            // Generate intelligent context
            const context = generateIntelligentContext(timeframe, analysis);
            
            container.innerHTML = `
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px;">
                    <h5 style="color: #8a2be2; margin-bottom: 15px;">ü§ñ An√°lisis Contextual Inteligente</h5>
                    <div style="background: rgba(138,43,226,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #8a2be2;">
                        <p style="margin-bottom: 15px;"><strong>Contexto:</strong> ${context.situation}</p>
                        <div style="margin-bottom: 15px;">
                            <h6 style="color: #ffd700; margin-bottom: 10px;">‚ö° OPORTUNIDADES MIENTRAS TANTO:</h6>
                            ${context.opportunities.map(opp => `
                                <div style="background: rgba(255,215,0,0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                    <strong>${opp.type}:</strong> ${opp.description}
                                </div>
                            `).join('')}
                        </div>
                        <p style="color: #00ff88;"><strong>Recomendaci√≥n:</strong> ${context.recommendation}</p>
                    </div>
                </div>
            `;
        }

        function generateIntelligentContext(timeframe, analysis) {
            const macroSetup = analysis.setups.find(s => s.type === 'primary');
            const immediateSetups = analysis.setups.filter(s => s.type !== 'primary');
            
            const context = {
                situation: `Aunque el objetivo macro de ${timeframe} es ${macroSetup.direction.toLowerCase()} hacia ${macroSetup.tp}, el mercado debe desarrollarse progresivamente.`,
                opportunities: [],
                recommendation: `Ejecuta setups inmediatos mientras esperas la confirmaci√≥n macro en ${macroSetup.timeframe}.`
            };

            immediateSetups.forEach((setup, index) => {
                context.opportunities.push({
                    type: setup.name,
                    description: `${setup.direction} desde ${setup.entry} ‚Üí ${setup.tp} (${setup.timeframe})`
                });
            });

            return context;
        }

        function updateAlertSystem(analysis) {
            const container = document.getElementById('alertItems');
            const alerts = generateAlerts(analysis);
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item alert-${alert.color}">
                    <h5 style="margin-bottom: 10px;">${alert.title}</h5>
                    <p style="font-size: 0.9rem; margin-bottom: 8px;">${alert.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="time-tag">${alert.timing}</span>
                        <span class="setup-badge ${alert.priority === 'ALTA' ? 'bearish' : alert.priority === 'MEDIA' ? 'neutral' : 'bullish'}">${alert.priority}</span>
                    </div>
                </div>
            `).join('');
        }

        function generateAlerts(analysis) {
            const alerts = [];
            
            analysis.setups.forEach(setup => {
                let color = 'yellow';
                let priority = 'MEDIA';
                
                if (setup.type === 'scalp') {
                    color = 'red';
                    priority = 'ALTA';
                } else if (setup.type === 'primary') {
                    color = 'orange';
                    priority = 'BAJA';
                }
                
                alerts.push({
                    title: `${setup.name} Disponible`,
                    description: `Setup ${setup.direction.toLowerCase()} form√°ndose en zona ${setup.entry}`,
                    timing: setup.timeframe,
                    color,
                    priority
                });
            });
            
            return alerts;
        }

        function advanceToNextTimeframe() {
            const timeframes = ['12M', '6M', '3M', 'MN', 'W1', 'D1', 'H4'];
            const currentIndex = timeframes.indexOf(currentTimeframe);
            
            if (currentIndex < timeframes.length - 1) {
                const nextTimeframe = timeframes[currentIndex + 1];
                currentTimeframe = nextTimeframe;
                updateTimeframeUI();
                
                // Show completion notification
                showCompletionNotification(timeframes[currentIndex], nextTimeframe);
            } else {
                // All timeframes completed
                showFinalExportReady();
            }
        }

        function showCompletionNotification(completed, next) {
            const notification = document.createElement('div');
            notification.className = 'fade-in';
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(0,255,136,0.95), rgba(0,212,255,0.95));
                color: #000;
                padding: 30px;
                border-radius: 20px;
                text-align: center;
                z-index: 1000;
                box-shadow: 0 20px 60px rgba(0,255,136,0.4);
                backdrop-filter: blur(15px);
            `;
            
            notification.innerHTML = `
                <h3 style="margin-bottom: 15px;">‚úÖ ${completed} Completado</h3>
                <p style="margin-bottom: 20px;">Avanzando autom√°ticamente a <strong>${next}</strong></p>
                <div class="spinner" style="margin: 0 auto; border-color: rgba(0,0,0,0.2); border-top-color: #000;"></div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

function showFinalExportReady() {
            updateExportPanel();
            
            const notification = document.createElement('div');
            notification.className = 'fade-in';
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(0,255,136,0.95), rgba(0,212,255,0.95));
                color: #000;
                padding: 30px;
                border-radius: 20px;
                text-align: center;
                z-index: 1000;
                box-shadow: 0 20px 60px rgba(0,255,136,0.4);
                backdrop-filter: blur(15px);
            `;
            
            notification.innerHTML = `
                <h3 style="margin-bottom: 15px;">üéâ ¬°AN√ÅLISIS COMPLETO!</h3>
                <p style="margin-bottom: 20px;">Todas las temporalidades analizadas con √©xito</p>
                <div style="color: #000; font-weight: bold;">Preparando export final...</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 4000);
        }

        function updateExportPanel() {
            const macroContainer = document.getElementById('macroContext');
            const setupsContainer = document.getElementById('exportSetups');
            const invalidationsContainer = document.getElementById('invalidations');
            
            // Macro context
            const macroAnalysis = completedTimeframes.map(tf => analysisData[tf]).filter(Boolean);
            macroContainer.innerHTML = `
                <p><strong>Direcci√≥n Macro (12M-6M):</strong> ${macroAnalysis[0]?.structure || 'An√°lisis completado'}</p>
                <p><strong>Temporalidades Analizadas:</strong> ${completedTimeframes.join(', ')}</p>
                <p><strong>Confluencia Total:</strong> ${Math.round((totalConfluenceScore / completedTimeframes.length) * 100)}%</p>
            `;
            
            // Export setups
            let allSetups = [];
            completedTimeframes.forEach(tf => {
                if (analysisData[tf]?.setups) {
                    allSetups = [...allSetups, ...analysisData[tf].setups];
                }
            });
            
            setupsContainer.innerHTML = allSetups.map(setup => `
                <div class="setup-card setup-${setup.type}">
                    <h5 style="color: #ffd700; margin-bottom: 10px;">${setup.name}</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                        <div>üìç ${setup.entry}</div>
                        <div>üéØ ${setup.tp}</div>
                        <div>‚è∞ ${setup.timeframe}</div>
                    </div>
                    <p style="margin-top: 8px; font-size: 0.9rem; opacity: 0.8;">${setup.description}</p>
                </div>
            `).join('');
            
            // Invalidations
            invalidationsContainer.innerHTML = `
                <div style="background: rgba(255,107,107,0.1); padding: 15px; border-radius: 10px; border-left: 4px solid #ff6b6b;">
                    <p><strong>Invalidaci√≥n Macro:</strong> Quiebre por debajo de soporte clave mensual</p>
                    <p><strong>Invalidaci√≥n Inmediata:</strong> P√©rdida de estructura en H4</p>
                    <p><strong>Se√±ales de Alerta:</strong> Cambio de car√°cter en menor temporalidad</p>
                </div>
            `;
        }

        function exportToPreciseExecution() {
            // Prepare comprehensive data for export
            const exportData = {
                macroContext: {
                    timeframesAnalyzed: completedTimeframes,
                    overallBias: determineMacroBias(),
                    confidenceLevel: Math.round((totalConfluenceScore / completedTimeframes.length) * 100),
                    keyLevels: extractKeyLevels()
                },
                immediateSetups: getImmediateSetups(),
                swingSetups: getSwingSetups(),
                macroSetups: getMacroSetups(),
                invalidationLevels: getInvalidationLevels(),
                timeline: getSetupTimeline()
            };
            
            // Store in sessionStorage for the execution page
            sessionStorage.setItem('compuZettaAnalysis', JSON.stringify(exportData));
            
            // Show export confirmation
            const exportConfirmation = document.createElement('div');
            exportConfirmation.className = 'fade-in';
            exportConfirmation.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(255,215,0,0.95), rgba(255,165,0,0.95));
                color: #000;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                z-index: 1000;
                box-shadow: 0 20px 60px rgba(255,215,0,0.4);
                backdrop-filter: blur(15px);
                max-width: 500px;
            `;
            
            exportConfirmation.innerHTML = `
                <h3 style="margin-bottom: 20px;">üì§ DATOS EXPORTADOS</h3>
                <div style="background: rgba(0,0,0,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <p><strong>Setups Detectados:</strong> ${exportData.immediateSetups.length + exportData.swingSetups.length + exportData.macroSetups.length}</p>
                    <p><strong>Temporalidades:</strong> ${exportData.macroContext.timeframesAnalyzed.join(', ')}</p>
                    <p><strong>Confianza:</strong> ${exportData.macroContext.confidenceLevel}%</p>
                </div>
                <p style="margin-bottom: 20px;">Datos listos para ejecuci√≥n precisa</p>
                <button onclick="this.parentElement.remove()" style="background: #000; color: #ffd700; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold;">
                    ‚úÖ CONTINUAR
                </button>
            `;
            
            document.body.appendChild(exportConfirmation);
        }

        function determineMacroBias() {
            const macroSetups = [];
            completedTimeframes.forEach(tf => {
                if (analysisData[tf]?.setups) {
                    const primarySetup = analysisData[tf].setups.find(s => s.type === 'primary');
                    if (primarySetup) macroSetups.push(primarySetup.direction);
                }
            });
            
            const bullishCount = macroSetups.filter(d => d === 'Alcista').length;
            const bearishCount = macroSetups.filter(d => d === 'Bajista').length;
            
            if (bullishCount > bearishCount) return 'Alcista';
            if (bearishCount > bullishCount) return 'Bajista';
            return 'Neutral';
        }

        function extractKeyLevels() {
            const levels = [];
            completedTimeframes.forEach(tf => {
                if (analysisData[tf]?.reactionZones) {
                    levels.push(...analysisData[tf].reactionZones.map(zone => ({
                        timeframe: tf,
                        price: zone.price,
                        type: zone.type
                    })));
                }
            });
            return levels;
        }

        function getImmediateSetups() {
            const immediateSetups = [];
            ['H4', 'D1'].forEach(tf => {
                if (analysisData[tf]?.setups) {
                    const scalps = analysisData[tf].setups.filter(s => s.type === 'scalp');
                    immediateSetups.push(...scalps);
                }
            });
            return immediateSetups;
        }

        function getSwingSetups() {
            const swingSetups = [];
            ['W1', 'D1'].forEach(tf => {
                if (analysisData[tf]?.setups) {
                    const swings = analysisData[tf].setups.filter(s => s.type === 'secondary');
                    swingSetups.push(...swings);
                }
            });
            return swingSetups;
        }

        function getMacroSetups() {
            const macroSetups = [];
            ['12M', '6M', '3M', 'MN'].forEach(tf => {
                if (analysisData[tf]?.setups) {
                    const macro = analysisData[tf].setups.filter(s => s.type === 'primary');
                    macroSetups.push(...macro);
                }
            });
            return macroSetups;
        }

        function getInvalidationLevels() {
            return [
                'Macro: Cierre mensual por debajo de 1.1200',
                'Swing: P√©rdida de estructura semanal',
                'Inmediato: Cambio de car√°cter en H4'
            ];
        }

        function getSetupTimeline() {
            return {
                immediate: '2-24 horas',
                shortTerm: '2-7 d√≠as',
                macro: '2-8 semanas'
            };
        }

        // Initialize the application
        updateTimeframeUI();
        updateOverallProgress();
    </script>
</body>
</html>
